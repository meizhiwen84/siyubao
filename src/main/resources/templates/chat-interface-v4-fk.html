<html lang="en"  xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">小红书</title>
    <script src="./xhs/tailwindcss.min.js"></script>
    <link href="./xhs/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#fe2c55', // 小红书标志性红色
                        secondary: '#f5f5f5', // 背景灰
                        chat: {
                            mine: '#1e88e5', // 我的消息（蓝色）
                            other: '#F2F2F2' // 对方消息
                        }
                    },
                    fontFamily: {
                        sans: ['PingFang SC', 'Helvetica Neue', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .chat-bubble-mine {
                border-radius: 18px 18px 18px 18px;
            }
            .chat-bubble-other {
                border-radius: 18px 18px 18px 18px;
            }
            .input-focus {
                @apply focus:outline-none focus:ring-2 focus:ring-primary/30;
            }
            .nav-btn {
                @apply w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors;
            }
            .msg-btn {
                @apply p-2 text-gray-500 hover:text-primary transition-colors duration-200;
            }
            .ellipsis-dot {
                display: inline-block;
                width: 4px;
                height: 4px;
                border-radius: 50%;
                background-color: black;
                margin: 0 2px;
            }
            .simple-angle-bracket {
                display: inline-block;
                font-size: 18px;
                line-height: 1;
                color: #4B5563;
                font-weight: normal;
            }
        }</style>
        
        <script>
            // 更新手机状态栏时间
            function updateStatusBarTime() {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                document.getElementById('status-bar-time').textContent = `${hours}:${minutes}`;
            }
            
            // 页面加载时更新时间
            window.addEventListener('DOMContentLoaded', () => {
                updateStatusBarTime();
                // 每分钟更新一次时间
                setInterval(updateStatusBarTime, 60000);
            });
        </script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="max-w-md mx-auto bg-white min-h-screen flex flex-col">
        <!-- 手机顶部状态栏 - 与导航栏背景色一致，只设置上边距，移除text-xs类 -->
    <div class="bg-white text-black pt-2 px-3 flex items-center justify-between font-medium sticky top-0 z-20">
        <div id="status-bar-time">14:30</div>
        <div class="flex items-center space-x-1.5">
                  <!-- 铜钟符号 -->
                <i class="fa fa-bell text-gray-700"></i>
                <!-- WiFi信号 -->
                <i class="fa fa-wifi text-gray-700"></i>
            <!-- 双卡移动信号 -->
            <i class="fa fa-signal text-gray-700"></i>
            <i class="fa fa-signal text-gray-700"></i>
            <!-- 电量 -->
            <i class="fa fa-battery-three-quarters text-gray-700"></i>
        </div>
    </div>
    
    <!-- 顶部导航栏 - 调整内边距使小于符号与下方头像对齐 -->
    <header class="py-3 px-3 flex items-center justify-between bg-white sticky top-[24px] z-10 h-16">
            <div class="flex items-center">
                <!-- 返回箭头按钮 - 简单小于符号 -->
                <button class="nav-btn mr-1">
                    <img src="/avatar/xhsfh.png" alt="返回" class="w-4 h-4">
                </button>
                
                <!-- 用户头像 -->
                <img src="xhs/images/avatar-64.jpg" th:src="${userPic}" alt="用户头像" class="w-10 h-10 rounded-full object-cover mr-3 border border-gray-100">
                
                <!-- 用户昵称 -->
                <div class="flex flex-col justify-center">
                    <h1 class="text-base font-semibold text-gray-900" th:text="${userName}">时尚穿搭达人</h1>
<!--                    <p class="text-xs text-gray-500">在线</p>-->
                </div>
            </div>
            
            <!-- 右侧三个点 - 修改为横向黑色，调整点之间的间距 -->
            <button class="nav-btn px-2">
                <div class="flex items-center">
                    <span class="ellipsis-dot"></span>
                    <span class="ellipsis-dot"></span>
                    <span class="ellipsis-dot"></span>
                </div>
            </button>
        </header>
        
        <!-- 聊天内容区域 -->
        <main class="flex-1 overflow-y-auto p-4 space-y-6 bg-white" style="padding-bottom: 120px;">
            <!-- 时间分割线 -->
            <div class="flex justify-center">
                <span class="text-xs text-gray-400 bg-white px-3 py-1 rounded-full" th:text="'今天 ' + ${firstDateTimeStr}">今天 14:30</span>
            </div>

            <!-- 对方消息 -->
            <div class="flex items-start space-x-3" th:each="cm,cmStats: ${xhsMsgList}">
                <span th:if="${cm.msgType==1}"><img src="xhs/images/avatar-64.jpg" th:src="${userPic}" alt="对方头像" class="w-10 h-10 rounded-full object-cover"></span>
                <div class="flex-1" th:class="${cm.msgType==2?'flex-1 text-right':'flex-1'}">
                    <div class="bg-chat-other px-4 py-3 chat-bubble-other shadow-sm max-w-[calc(100%-3rem)] inline-block" th:class="${cm.msgType==2?'bg-chat-mine text-white px-4 py-3 chat-bubble-mine shadow-sm max-w-[calc(100%-3rem)] inline-block text-left':'bg-chat-other px-4 py-3 chat-bubble-other shadow-sm max-w-[calc(100%-3rem)] inline-block'}">
                        <p th:text="${cm.msg}">具体时间还不确定</p>
                    </div>
                </div>
                <span th:if="${cm.msgType==2}"><img src="xhs/images/avatar-65.jpg" th:src="${myPic}" alt="我的头像" class="w-10 h-10 rounded-full object-cover"></span>
            </div>

            <!-- 时间分割线 -->
            <div class="flex justify-center">
                <span class="text-xs text-gray-400 bg-white px-3 py-1 rounded-full" th:text="${fankuiDateTimeStr}">今天 14:30</span>
            </div>

            <!--最后一句反馈-->
            <div class="flex items-start space-x-3">
                <div class="flex-1 text-right">
                    <div class="bg-chat-mine text-white px-4 py-3 chat-bubble-mine shadow-sm max-w-[calc(100%-3rem)] inline-block text-left">
                        <p>亲;这边管家已经加您了哈;您通过-下哦</p>
                    </div>
                </div>
                <img src="xhs/images/avatar-65.jpg" th:src="${myPic}" alt="我的头像" class="w-10 h-10 rounded-full object-cover">
            </div>

        </main>
        
        <!-- 图片显示区域 -->
        <div class="flex justify-center pt-2 pb-1 bg-white fixed bottom-16 left-0 right-0 z-10" style="max-width: 448px; margin: 0 auto;">
            <img src="/avatar/xhskj.png" alt="小红书科技" style="width: 360px; height: auto;">
        </div>
        
        <!-- 底部发消息区域 -->
        <footer class="p-3 bg-white fixed bottom-0 left-0 right-0 z-20" style="max-width: 448px; margin: 0 auto;">
            <div class="flex items-center gap-1">
                <!-- 输入框 -->
                <div class="flex-1 relative">
                    <!-- 语音输入按钮 (在输入框内部) -->
                    <button class="absolute left-1 top-1/2 transform -translate-y-1/2 w-10 h-10 rounded-full bg-transparent text-gray-500 flex items-center justify-center hover:bg-gray-200 active:scale-95 transition-all z-10" id="voiceInputBtn">
                        <img src="/avatar/yy.png" alt="语音" class="w-5 h-5">
                    </button>
                    <!-- 表情按钮 (在输入框内部右侧) -->
                    <button class="absolute right-10 top-1/2 transform -translate-y-1/2 w-10 h-10 rounded-full bg-transparent text-gray-500 flex items-center justify-center hover:bg-gray-200 active:scale-95 transition-all z-10" id="emojiBtn">
                        <img src="/avatar/bq.png" alt="表情" class="w-5 h-5">
                    </button>
                    <!-- +号按钮 (在输入框内部右侧) -->
                    <button class="absolute right-1 top-1/2 transform -translate-y-1/2 w-10 h-10 rounded-full bg-transparent text-gray-500 flex items-center justify-center hover:bg-gray-200 active:scale-95 transition-all z-10" id="plusBtn">
                        <img src="/avatar/fs.png" alt="更多" class="w-5 h-5">
                    </button>
                    <textarea placeholder="发消息..." class="w-full py-3 pl-12 pr-24 rounded-full bg-gray-100 resize-none input-focus transition-all" rows="1" style="min-height: 46px; max-height: 120px;" id="msgInput"></textarea>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // 返回按钮功能
        document.querySelector('.nav-btn:first-of-type').addEventListener('click', function() {
            // 实际应用中替换为 window.history.back()
            alert('返回上一页');
        });
        
        // 语音输入按钮功能
        const voiceInputBtn = document.getElementById('voiceInputBtn');
        let isRecording = false;
        
        voiceInputBtn.addEventListener('click', function() {
            if (isRecording) {
                // 停止录音
                stopVoiceRecording();
            } else {
                // 开始录音
                startVoiceRecording();
            }
        });
        
        function startVoiceRecording() {
            // 检查浏览器是否支持语音识别
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                isRecording = true;
                voiceInputBtn.classList.remove('bg-gray-100', 'text-gray-700');
                voiceInputBtn.classList.add('bg-primary', 'text-white');
                voiceInputBtn.innerHTML = '<i class="fa fa-microphone-slash text-lg"></i>';
                
                // 这里可以实现实际的语音识别功能
                alert('语音输入已启动，请说话...');
            } else {
                alert('您的浏览器不支持语音识别功能');
            }
        }
        
        function stopVoiceRecording() {
            isRecording = false;
            voiceInputBtn.classList.remove('bg-primary', 'text-white');
            voiceInputBtn.classList.add('bg-gray-100', 'text-gray-700');
            voiceInputBtn.innerHTML = '<img src="/avatar/yy.png" alt="语音" class="w-5 h-5">';
            
            // 模拟语音识别结果
            alert('语音输入已停止');
            // 在实际应用中，这里可以将识别的文本添加到输入框中
            // msgInput.value = '识别到的语音文本';
        }
        
        // 获取消息输入框
        const msgInput = document.getElementById('msgInput');
        
        // 检查.msg-btn元素是否存在，如果存在则添加事件监听器
        const leftArrowBtn = document.querySelector('.msg-btn:first-of-type');
        if (leftArrowBtn) {
            leftArrowBtn.addEventListener('click', function() {
                alert('向左箭头按钮被点击');
            });
        }
        
        // 自动调整文本框高度
        msgInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
            
            // 限制最大高度
            if (this.scrollHeight > 120) {
                this.style.height = '120px';
                this.style.overflowY = 'auto';
            } else {
                this.style.overflowY = 'hidden';
            }
        });
        
        // 发送消息功能
        // 通过Enter键发送消息（不使用Shift键）
        msgInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        function sendMessage() {
            const message = msgInput.value.trim();
            if (!message) return;
            
            // 创建新消息元素
            const main = document.querySelector('main');
            const now = new Date();
            const timeString = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            const messageHTML = `
                <div class="flex items-start justify-end space-x-1 animate-fadeIn">
                    <div class="flex-1 text-right">
                        <div class="bg-chat-mine text-white px-4 py-3 max-w-[calc(100%-3rem)] chat-bubble-mine shadow-sm inline-block text-left">
                            <p>${message}</p>
                        </div>
                    </div>
                    <img src="xhs/images/avatar-65.jpg" alt="我的头像" class="w-10 h-10 rounded-full object-cover">
                </div>
            `;
            
            main.insertAdjacentHTML('beforeend', messageHTML);
            msgInput.value = '';
            msgInput.style.height = 'auto';
            
            // 滚动到底部
            main.scrollTop = main.scrollHeight;
        }
    </script>


</body></html>